-- GeneratorClient (LocalScript dalam ScreenGui)
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")

local player = Players.LocalPlayer
local GeneratorEvent = ReplicatedStorage:WaitForChild("GeneratorEvent")

-- Ganti path sesuai struktur GUI Anda
local screenGui = script.Parent
local main = screenGui:WaitForChild("Main")
local title = main:WaitForChild("Title")
local resourceLabel = main:WaitForChild("ResourceLabel")
local startStopBtn = main:WaitForChild("StartStopButton")
local collectBtn = main:WaitForChild("CollectButton")
local upgradeBtn = main:WaitForChild("UpgradeButton")

local running = false

local function updateUI(data)
    -- data diharapkan table {buffer, balance, rate, interval, upgradeLevel, nextUpgradeCost}
    resourceLabel.Text = string.format("Buffer: %d  |  Balance: %d\nRate: %.1f / %ds  |  Lv: %d  | Next upgrade: %d",
        data.buffer or 0, data.balance or 0, data.rate or 0, data.interval or 0, data.upgradeLevel or 0, data.nextUpgradeCost or 0)
    if data.running then
        startStopBtn.Text = "Stop"
    else
        startStopBtn.Text = "Start"
    end
end

-- Tombol start/stop
startStopBtn.MouseButton1Click:Connect(function()
    if running then
        GeneratorEvent:FireServer("stop")
        running = false
        startStopBtn.Text = "Start"
    else
        GeneratorEvent:FireServer("start")
        running = true
        startStopBtn.Text = "Stop"
    end
end)

-- Tombol collect
collectBtn.MouseButton1Click:Connect(function()
    GeneratorEvent:FireServer("collect")
end)

-- Tombol upgrade
upgradeBtn.MouseButton1Click:Connect(function()
    GeneratorEvent:FireServer("upgrade")
end)

-- Terima event dari server
GeneratorEvent.OnClientEvent:Connect(function(eventType, payload)
    if eventType == "update" then
        updateUI(payload)
    elseif eventType == "collected" then
        updateUI(payload)
        -- animasi singkat atau efek bisa ditambahkan di sini
    elseif eventType == "upgraded" then
        updateUI(payload)
        -- notifikasi
    elseif eventType == "upgrade_failed" then
        -- tampilkan alasan
        -- contoh sederhana: perubahan teks title
        title.Text = "Upgrade failed: " .. (payload.reason or "unknown")
        wait(2)
        title.Text = "Generator"
    elseif eventType == "stopped" then
        running = false
        startStopBtn.Text = "Start"
    end
end)

-- Ambil state awal
GeneratorEvent:FireServer("get_state")
